---
layout: post
title: Face Detection and iPhone Video Streaming
date: '2009-02-15T11:44:00.005-05:00'
author: rammic
tags:
- facial detection
- iphone
- geek
modified_time: '2009-02-15T12:37:57.915-05:00'
thumbnail: http://1.bp.blogspot.com/_wC5IWJgdgwA/SZhRDgHQUAI/AAAAAAAAC58/5hHE5t-zF9w/s72-c/FaceDetectionDiagram.png
blogger_id: tag:blogger.com,1999:blog-6180833599810788176.post-8493060271740715406
blogger_orig_url: http://blog.rammic.com/2009/02/face-detection-and-iphone-video.html
---

I recently purchased a Linksys WVC54GCA WiFi camera. It's a wonderful little camera, but my primary reason for purchasing it was to be able to stream video to my iPhone; it uses Motion JPEG which is the only video option available in Mobile Safari. It actually works very well, though my intention is to eventually attach it to my iRobot Create to give it "vision." More on that later.<div><div style="text-align: center;"><br /></div><div style="text-align: center;"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 300px; height: 443px;" src="http://www.wifilab.net/wifi/images/stories/linksys-wvc54gca.jpg" border="0" alt="" /></div><div style="text-align: center;"><br /></div><div>Anyway, despite the camera's strengths, there are a few limitations. First, the camera can only support 4 simultaneous clients and the performance degrades linearly with each additional client (from my anecdotal experience). Second, the only access control the camera offers is HTTP Basic Authentication backed with a 4-user list configurable from its web interface that doesn't integrate well with any other application or security system. I figured that the best and most direct way of fixing the problems was to proxy the feed through my MacPro to manage the connection and user access there instead of on the camera.</div><div><br /></div><div><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 257px; height: 320px;" src="http://1.bp.blogspot.com/_wC5IWJgdgwA/SZhRDgHQUAI/AAAAAAAAC58/5hHE5t-zF9w/s320/FaceDetectionDiagram.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5303077681830580226" /></div><div style="text-align: center;"><br /></div><div>As I was imagineering this system, I also got the bright idea to go ahead and do facial detection (not recognition -yet-) on the stream. After doing some research on the technology, I decided to use the <a href="http://opencv.willowgarage.com/wiki/">OpenCV</a> libraries developed by Intel and subsequently open sourced. My initial prototypes were extremely slow (1-2 FPS) since the Java libraries depended on JNI calls to a non-thread-safe C library. I did more research and found the <a href="http://faint.sourceforge.net/">Faint</a> (Face Annotation Interface) library which did Haar in pure, multithread-able Java. (I had to take the beta code from the SVN since it wasn't released yet.) That finally got me a much more acceptable 10+ FPS.</div><div><br /></div><div><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 200px; height: 150px;" src="http://4.bp.blogspot.com/_wC5IWJgdgwA/SZhP_x2udvI/AAAAAAAAC50/1aLaQdI9mTQ/s200/FaceDetection.jpeg" border="0" alt="" id="BLOGGER_PHOTO_ID_5303076518361986802" /></div><div><br /></div><div>Now I have the camera stream being cached within a custom-built Tomcat webapp that does the detection and also provides security for the stream. It can support much more than the 4 users available from the camera and without a FPS hit. It's pretty cool. Right now it just draws a red rectangle around the detected face, but obviously more triggers and actions are possible and desirable. It should definitely be noted that the stream (with facial detection) is viewable from the iPhone! Now- to just get the damned thing attached to my iRobot and my little mobile sentry will be complete. :)</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div></div>